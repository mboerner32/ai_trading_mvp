<!DOCTYPE html>
<html>
<head>
    <title>Trades â€“ Reno Robs Trading</title>

    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
            background-color: #f7f9fc;
            color: #1f2937;
        }

        .navbar {
            background: white;
            padding: 18px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .navbar h2 { margin: 0; font-weight: 600; }

        .nav-links a {
            margin-left: 20px;
            text-decoration: none;
            font-weight: 500;
            color: #4f46e5;
        }

        .logout { color: #dc2626; }

        .container {
            padding: 40px;
            max-width: 1300px;
            margin: auto;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.05);
        }

        .card h3 {
            margin: 0;
            font-size: 14px;
            color: #6b7280;
        }

        .card p {
            font-size: 28px;
            font-weight: 600;
            margin-top: 8px;
            margin-bottom: 0;
        }

        .positive { color: #16a34a; }
        .negative { color: #dc2626; }
        .neutral  { color: #1f2937; }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 14px rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
        }

        th {
            background: #f3f4f6;
            font-weight: 600;
        }

        tr:not(:last-child) {
            border-bottom: 1px solid #f1f1f1;
        }

        .good { color: #16a34a; font-weight: 600; }
        .bad  { color: #dc2626; font-weight: 600; }

        .sell-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .sell-btn:hover { background: #b91c1c; }

        .empty-note {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.05);
            color: #6b7280;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }
    </style>
</head>

<body>

<div class="navbar">
    <div style="display:flex; align-items:center; gap:12px;">
        <img src="/static/logo.png" alt="Logo" style="height:44px; width:auto; border-radius:6px;">
        <h2 style="margin:0;">Reno Robs Trading</h2>
    </div>

    <div class="nav-links">
        <span style="margin-right:20px; color:#6b7280;">
            Logged in as {{ user }}
        </span>
        <a href="/dashboard">Dashboard</a>
        <a href="/analytics">Analytics</a>
        <a href="/trades">Trades</a>
        <a href="/logout" class="logout">Logout</a>
    </div>
</div>

<div class="container">

    <h2 style="margin-bottom:30px;">Paper Trading</h2>

    <!-- PORTFOLIO SUMMARY -->
    <div class="kpi-grid">

        <div class="card">
            <h3>Cash Balance</h3>
            <p class="neutral">${{ "{:,.2f}".format(summary.cash) }}</p>
        </div>

        <div class="card">
            <h3>Open Positions Value</h3>
            <p class="neutral">${{ "{:,.2f}".format(summary.open_value) }}</p>
        </div>

        <div class="card">
            <h3>Total Portfolio Value</h3>
            <p class="neutral">${{ "{:,.2f}".format(summary.total_value) }}</p>
        </div>

        <div class="card">
            <h3>Total P&amp;L</h3>
            <p class="{{ 'positive' if summary.total_pnl >= 0 else 'negative' }}">
                {{ "+" if summary.total_pnl >= 0 else "" }}${{ "{:,.2f}".format(summary.total_pnl) }}
            </p>
        </div>

    </div>

    <!-- AUTO-CLOSE NOTIFICATIONS -->
    {% if auto_closed %}
    <div style="background:#f0fdf4; border:1px solid #86efac; border-radius:10px;
                padding:16px 20px; margin-bottom:24px;">
        <div style="font-weight:700; color:#15803d; margin-bottom:8px;">
            ðŸŽ¯ Target Hit â€” Position{{ 's' if auto_closed|length > 1 else '' }} Auto-Sold at +20%
        </div>
        {% for t in auto_closed %}
        <div style="font-size:14px; color:#166534;">
            <strong>{{ t.symbol }}</strong> sold at ${{ t.exit_price }} &nbsp;Â·&nbsp;
            P&amp;L: <strong>+${{ "{:,.2f}".format(t.realized_pnl) }}</strong>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- OPEN POSITIONS -->
    <div class="section-title">Open Positions</div>

    {% if positions %}
    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Entry Price</th>
                <th>Target (+20%)</th>
                <th>Current Price</th>
                <th>To Target</th>
                <th>Shares</th>
                <th>Current Value</th>
                <th>Unrealized P&amp;L</th>
                <th>P&amp;L %</th>
                <th>Opened</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        {% for pos in positions %}
            <tr>
                <td><strong>{{ pos.symbol }}</strong></td>
                <td>${{ pos.entry_price }}</td>
                <td style="color:#0f766e; font-weight:600;">${{ pos.target_price }}</td>
                <td>${{ pos.current_price }}</td>
                <td style="font-size:13px; color:{{ '#16a34a' if pos.to_target_pct <= 5 else '#6b7280' }};">
                    {% if pos.to_target_pct <= 0 %}
                        ðŸŽ¯ At target
                    {% else %}
                        +{{ pos.to_target_pct }}% away
                    {% endif %}
                </td>
                <td>{{ pos.shares | round(2) }}</td>
                <td>${{ "{:,.2f}".format(pos.current_value) }}</td>
                <td class="{{ 'good' if pos.unrealized_pnl >= 0 else 'bad' }}">
                    {{ "+" if pos.unrealized_pnl >= 0 else "" }}${{ "{:,.2f}".format(pos.unrealized_pnl) }}
                </td>
                <td class="{{ 'good' if pos.pnl_pct >= 0 else 'bad' }}">
                    {{ "+" if pos.pnl_pct >= 0 else "" }}{{ pos.pnl_pct }}%
                </td>
                <td style="font-size:12px; color:#6b7280;">
                    {{ pos.opened_at[:16].replace("T", " ") }}
                </td>
                <td>
                    <form method="post" action="/trade/sell/{{ pos.trade_id }}">
                        <button type="submit" class="sell-btn">Sell</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-note">No open positions. Buy a stock from the Dashboard to get started.</div>
    {% endif %}

    <!-- TRADE HISTORY -->
    <div class="section-title">Trade History</div>

    {% if history %}
    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Entry Price</th>
                <th>Exit Price</th>
                <th>Shares</th>
                <th>Realized P&amp;L</th>
                <th>P&amp;L %</th>
                <th>Opened</th>
                <th>Closed</th>
            </tr>
        </thead>
        <tbody>
        {% for trade in history %}
            <tr>
                <td><strong>{{ trade.symbol }}</strong></td>
                <td>${{ trade.entry_price }}</td>
                <td>${{ trade.exit_price }}</td>
                <td>{{ trade.shares }}</td>
                <td class="{{ 'good' if trade.realized_pnl >= 0 else 'bad' }}">
                    {{ "+" if trade.realized_pnl >= 0 else "" }}${{ "{:,.2f}".format(trade.realized_pnl) }}
                </td>
                <td class="{{ 'good' if trade.pnl_pct >= 0 else 'bad' }}">
                    {{ "+" if trade.pnl_pct >= 0 else "" }}{{ trade.pnl_pct }}%
                </td>
                <td style="font-size:12px; color:#6b7280;">
                    {{ trade.opened_at[:16].replace("T", " ") }}
                </td>
                <td style="font-size:12px; color:#6b7280;">
                    {{ trade.closed_at[:16].replace("T", " ") }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-note">No closed trades yet.</div>
    {% endif %}

</div>

</body>
</html>
